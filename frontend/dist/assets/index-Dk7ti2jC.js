import{j as e,M as ve,r as ye,a as ke,b as Ne}from"./markdown-vendor-BbpIqeYM.js";import{a as Ce,r as n,R as Se}from"./react-vendor-CuqJ0ABB.js";import"./katex-vendor-DhIX2AT_.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function t(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}})();var ae,X=Ce;ae=X.createRoot,X.hydrateRoot;function Ee({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{fillRule:"evenodd",d:"M15.75 1.5a6.75 6.75 0 0 0-6.651 7.906c.067.39-.032.717-.221.906l-6.5 6.499a3 3 0 0 0-.878 2.121v2.818c0 .414.336.75.75.75H6a.75.75 0 0 0 .75-.75v-1.5h1.5A.75.75 0 0 0 9 19.5V18h1.5a.75.75 0 0 0 .53-.22l2.658-2.658c.19-.189.517-.288.906-.22A6.75 6.75 0 1 0 15.75 1.5Zm0 3a.75.75 0 0 0 0 1.5A2.25 2.25 0 0 1 18 8.25a.75.75 0 0 0 1.5 0 3.75 3.75 0 0 0-3.75-3.75Z",clipRule:"evenodd"}))}const Re=n.forwardRef(Ee);function De({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"}))}const _e=n.forwardRef(De);function Ae({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{fillRule:"evenodd",d:"M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z",clipRule:"evenodd"}))}const Me=n.forwardRef(Ae),h={debug:(s,...a)=>{},info:(s,...a)=>{},warn:(s,...a)=>{console.warn(`[WARN] ${s}`,...a)},error:(s,...a)=>{console.error(`[ERROR] ${s}`,...a)}},Ie=(s,a)=>{},$e=()=>{const[s,a]=n.useState([]),[r,t]=n.useState(""),[o,d]=n.useState(!1),[i,m]=n.useState(""),[g,f]=n.useState(!1),x=n.useRef(null),y=()=>{var j;(j=x.current)==null||j.scrollIntoView({behavior:"smooth"})};return n.useEffect(()=>{y()},[s]),{messages:s,input:r,setInput:t,isLoading:o,setIsLoading:d,apiKey:i,setApiKey:m,showApiKey:g,setShowApiKey:f,messagesEndRef:x,addMessage:j=>{a(v=>[...v,j])},handleSubmit:async j=>{var p;if(j.preventDefault(),!r.trim()||!i||o)return;const v=r.trim();t("");const D={role:"user",content:v};a(c=>[...c,D]),d(!0);try{const c=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({developer_message:"You are a helpful assistant.",user_message:v,model:"gpt-4o-mini",api_key:i})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const l=(p=c.body)==null?void 0:p.getReader();if(!l)throw new Error("No reader available");const u=new TextDecoder;let b="";const S={role:"assistant",content:""};for(a(N=>[...N,S]);;){const{done:N,value:E}=await l.read();if(N)break;const I=u.decode(E);b+=I,S.content=b,a($=>{const _=[...$];return _[_.length-1]={...S},_})}}catch(c){h.error("Chat error:",c),a(l=>[...l,{role:"assistant",content:`Sorry, I encountered an error: ${c instanceof Error?c.message:"Unknown error"}`}])}finally{d(!1)}}}},ne=async(s,a,r)=>{h.debug("Initiating document upload to knowledge base",{fileName:s.name,fileSize:s.size,fileType:s.type,sessionId:r});const t=new FormData;t.append("file",s),t.append("api_key",a),r&&t.append("session_id",r);const o=await fetch("/api/upload-document",{method:"POST",body:t});if(!o.ok){const i=await o.json();throw h.error("Document upload failed",{status:o.status,error:i}),new Error(i.detail||`Document upload failed with status: ${o.status}`)}const d=await o.json();return h.info("Document successfully uploaded to knowledge base",d),d},Te=ne,Pe=async s=>{var t;const a={user_message:s.userMessage,session_id:s.sessionId,api_key:s.apiKey,model:s.model||"gpt-4o-mini",use_rag:s.useRag!==!1};h.debug("Sending RAG-enhanced message request",{sessionId:s.sessionId,model:s.model,useRag:s.useRag,messageLength:s.userMessage.length});const r=await fetch("/api/rag-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const o=await r.text();throw h.error("RAG-enhanced message request failed",{status:r.status,error:o}),new Error(`RAG request failed with status: ${r.status} - ${o}`)}return h.info("RAG-enhanced message request successful, starting stream"),((t=r.body)==null?void 0:t.getReader())||null},z=async s=>{const a=await fetch(`/api/session/${s}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()},Le=async s=>{const a=await fetch(`/api/session/${s}`,{method:"DELETE"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`)},Oe=async()=>{const s=await fetch("/api/global-knowledge-base");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()},Ue=async(s,a)=>{h.debug("Attempting to remove document from knowledge base",{filename:s});const r=await fetch(`/api/document/${encodeURIComponent(s)}?api_key=${encodeURIComponent(a)}`,{method:"DELETE"});if(!r.ok){const t=await r.json();throw h.error("Failed to remove document from knowledge base",{filename:s,status:r.status,error:t}),new Error(t.detail||`Failed to delete document with status: ${r.status}`)}h.info("Document successfully removed from knowledge base",{filename:s})},Ge=Ue,Fe=()=>{const[s,a]=n.useState(null),[r,t]=n.useState(!1),[o,d]=n.useState(null),[i,m]=n.useState(null);n.useEffect(()=>{i&&g(i)},[i]);const g=async p=>{try{const c=await z(p);h.debug("Loaded session info:",c),a(c),c&&c.session_id&&m(c.session_id)}catch(c){h.error("Failed to load session info:",c),a(null),m(null)}},f=n.useCallback(async(p,c)=>{t(!0),d(null);try{h.debug("Starting document upload process",{fileName:p.name,fileSize:p.size});const l=await ne(p,c,i||void 0);Ie("upload-document",l),m(l.session_id);const u={session_id:l.session_id,document_count:l.document_count,documents:[l.filename],created_at:new Date().toISOString()};return s&&(u.documents=[...new Set([...s.documents,l.filename])],u.created_at=s.created_at),h.debug("Setting session info:",u),a(u),setTimeout(()=>g(l.session_id),100),l}catch(l){const u=l instanceof Error?l.message:"Upload failed";return h.error("Document upload failed",l),d(u),null}finally{t(!1)}},[i,s]),x=n.useCallback(async(p,c,l,u=!0)=>{let b=i||(s==null?void 0:s.session_id);h.debug("SendRAGChat - sessionId:",i,"sessionInfo.session_id:",s==null?void 0:s.session_id,"using:",b),b||(h.debug("No active session, generating temporary session for global knowledge base access"),b=`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,h.debug("Generated temporary session ID:",b));const S={userMessage:p,sessionId:b,apiKey:c,model:l,useRag:u};try{const N=await Pe(S);if(!i&&!s&&b.startsWith("temp-")){h.debug("Checking if backend created a session for temporary session");try{const E=await z(b);E&&(h.debug("Backend created session for us:",E),m(b),a(E))}catch{h.debug("Temporary session not found on backend, using global knowledge base")}}return N}catch(N){throw N instanceof Error&&N.message.includes("Session not found")&&(h.warn("Session no longer exists on server, clearing local session state"),a(null),m(null),d("Your session has expired. Please upload your documents again.")),N}},[i,s]);return{sessionInfo:s,sessionId:i,isUploading:r,uploadError:o,handleDocumentUpload:f,sendRAGEnhancedChatMessage:x,handlePDFUpload:f,sendRAGChat:x,clearSession:async()=>{if(i)try{await Le(i)}catch(p){h.error("Failed to delete session:",p)}a(null),m(null),d(null)},refreshSessionInfo:async p=>{const c=p||i;c&&await g(c)},validateSession:async()=>{if(!i&&!(s!=null&&s.session_id))return!1;const p=i||(s==null?void 0:s.session_id);if(!p)return!1;if(p.startsWith("temp-"))return h.debug("Skipping validation for temporary session:",p),!0;try{return await z(p),!0}catch{return h.warn("Session validation failed, clearing local state"),a(null),m(null),d("Your session has expired. Please upload your documents again."),!1}},hasActiveSession:(p=!1)=>{const c=!!(s&&s.document_count>0),l=!!(i||s!=null&&s.session_id);return h.debug("Has active session check:",{hasSession:c,hasSessionId:l,globalKBReady:p,sessionInfo:s,sessionId:i}),c&&l||p},getDocumentCount:()=>(s==null?void 0:s.document_count)||0,getUploadedDocuments:()=>(s==null?void 0:s.documents)||[],clearUploadError:()=>d(null)}},te=()=>{const[s,a]=n.useState(null),[r,t]=n.useState(!0),[o,d]=n.useState(null),[i,m]=n.useState(null),[g,f]=n.useState(!1),x=n.useRef(null),y=n.useRef(0),w=n.useRef(!1),k=async(l=!1)=>{if(w.current){console.log("ðŸ”„ Request already in progress, skipping...");return}try{w.current=!0,l?f(!0):t(!0),m(null);const u=await Oe();if(x.current!==null&&u.document_count!==x.current){const b=u.document_count-x.current,S=b>0?"Added":"Removed",N=b>0?"ðŸ“ˆ":"ðŸ“‰";console.log(`${N} Global KB updated: ${S} ${Math.abs(b)} document(s) - Total: ${u.document_count}`),console.log(`ðŸ“Š KB Status: ${u.original_document_count} original + ${u.user_uploaded_document_count} user-uploaded = ${u.document_count} total`)}x.current=u.document_count,a(u),y.current=Date.now()}catch(u){const b=u instanceof Error?u.message:"Unknown error";console.error("âŒ Error fetching global knowledge base:",b),m(b)}finally{w.current=!1,l?f(!1):t(!1)}},j=async(l,u)=>{try{if(d(l),m(null),s){const b={...s,user_uploaded_documents:s.user_uploaded_documents.filter(S=>S!==l),user_uploaded_document_count:s.user_uploaded_document_count-1,document_count:s.document_count-1};a(b)}return await Ge(l,u),console.log(`ðŸ—‘ï¸ Document "${l}" deleted, refreshing Global KB...`),await k(!0),!0}catch(b){const S=b instanceof Error?b.message:"Failed to delete document";return console.error("Error deleting document:",S),m(S),await k(!0),!1}finally{d(null)}};n.useEffect(()=>{k();const l=setInterval(()=>{if(w.current){console.log("â­ï¸ Skipping poll - request in progress");return}const u=Date.now()-y.current;!s||s.status!=="ready"?u>1e4&&k(!0):u>3e4&&k(!0)},1e4);return()=>clearInterval(l)},[s==null?void 0:s.status]),n.useEffect(()=>{(s==null?void 0:s.status)==="ready"&&x.current===null&&(console.log("ðŸ“š Global KB initialized, setting up auto-refresh..."),x.current=s.document_count)},[s==null?void 0:s.status]);const v=(s==null?void 0:s.status)==="ready",D=(s==null?void 0:s.status)==="error"||i!==null,p=(s==null?void 0:s.status)==="not_initialized"||r,c=s&&(s.original_document_count>0||s.user_uploaded_document_count>0);return{globalKB:s,isLoading:r,isDeleting:o,error:i,isReady:v,hasError:D,hasDocuments:c,isInitializing:p,isAutoRefreshing:g,refresh:k,deleteUserDocument:j}};function He({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const re=n.forwardRef(He);function Ve({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const ze=n.forwardRef(Ve);function Ze({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const We=n.forwardRef(Ze);function Ye({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Z=n.forwardRef(Ye);function Be({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const M=n.forwardRef(Be);function qe({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"}))}const Je=n.forwardRef(qe);function Ke({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"}))}const Q=n.forwardRef(Ke);function Xe({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"}))}const oe=n.forwardRef(Xe);function Qe({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const es=n.forwardRef(Qe);function ss({title:s,titleId:a,...r},t){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),s?n.createElement("title",{id:a},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const le=n.forwardRef(ss),as=({apiKey:s,onEnterApiKey:a,hasRAG:r=!1,ragMode:t=!1,globalKB:o=null,onTryGlobalKB:d})=>e.jsx("div",{className:"welcome-section",children:e.jsxs("div",{className:"welcome-content",children:[e.jsxs("div",{className:"welcome-header",children:[e.jsx("h2",{className:"welcome-title",children:"Welcome to OpenAI Chat"}),r&&e.jsxs("div",{className:"rag-status-welcome",children:[e.jsx(oe,{className:"rag-icon-welcome"}),e.jsx("span",{children:t?"RAG Mode Active":"RAG Mode Available"})]})]}),s?r?e.jsxs("div",{className:"welcome-rag",children:[e.jsx("p",{className:"welcome-description",children:t?"You're in RAG mode! Your questions will be answered using content from your uploaded documents.":"You have documents uploaded. Toggle RAG mode to chat with your documents, or continue with regular chat."}),e.jsxs("div",{className:"welcome-features",children:[e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ“„"}),e.jsx("span",{children:"Chat with your documents"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ”"}),e.jsx("span",{children:"Get answers from document content"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"âš¡"}),e.jsx("span",{children:"Real-time streaming responses"})]})]})]}):e.jsxs("div",{className:"welcome-chat",children:[e.jsx("p",{className:"welcome-description",children:"Start a conversation with AI! Upload a document to enable RAG mode and chat with your documents."}),o&&o.status==="ready"&&e.jsxs("div",{className:"global-kb-section",children:[e.jsx("h3",{className:"global-kb-title",children:"ðŸ›ï¸ Pre-loaded Regulatory Knowledge Base"}),e.jsx("p",{className:"global-kb-description",children:o.description}),e.jsxs("div",{className:"global-kb-stats",children:[e.jsxs("div",{className:"kb-stat",children:[e.jsx("span",{className:"kb-stat-number",children:o.document_count}),e.jsx("span",{className:"kb-stat-label",children:"Documents"})]}),e.jsxs("div",{className:"kb-stat",children:[e.jsx("span",{className:"kb-stat-number",children:o.chunk_count}),e.jsx("span",{className:"kb-stat-label",children:"Text Chunks"})]})]}),e.jsxs("div",{className:"global-kb-docs",children:[e.jsx("summary",{className:"kb-docs-title",children:"ðŸ“„ Available Documents:"}),e.jsxs("div",{className:"kb-docs-list",children:[o.documents.slice(0,5).map((i,m)=>e.jsxs("div",{className:"kb-doc-item",children:[e.jsx("span",{className:"kb-doc-icon",children:i.includes("Basel")?"ðŸ“Š":i.includes("COREP")||i.includes("FINREP")?"ðŸ“‹":i.includes("SQL")?"ðŸ’¾":i.includes("Jira")?"ðŸŽ«":i.includes("Policy")?"ðŸ“œ":"ðŸ“„"}),e.jsx("span",{className:"kb-doc-name",children:i})]},m)),o.documents.length>5&&e.jsxs("div",{className:"kb-doc-item",children:[e.jsx("span",{className:"kb-doc-icon",children:"âž•"}),e.jsxs("span",{className:"kb-doc-name",children:["+",o.documents.length-5," more documents"]})]})]})]}),d&&e.jsx("button",{onClick:d,className:"try-global-kb-button",children:"ðŸš€ Try asking about Basel III or regulatory reporting!"})]}),o&&o.status==="not_initialized"&&e.jsxs("div",{className:"global-kb-loading",children:[e.jsx("div",{className:"loading-spinner",children:"â³"}),e.jsx("p",{children:"Loading regulatory knowledge base..."})]}),o&&o.status==="error"&&e.jsxs("div",{className:"global-kb-error",children:[e.jsx("div",{className:"error-icon",children:"âš ï¸"}),e.jsx("p",{children:"Global knowledge base unavailable"})]}),e.jsxs("div",{className:"welcome-features",children:[e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ’¬"}),e.jsx("span",{children:"Natural conversation with AI"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ“"}),e.jsx("span",{children:"Markdown formatting support"})]}),e.jsxs("div",{className:"feature-item",children:[e.jsx("span",{className:"feature-icon",children:"ðŸ§®"}),e.jsx("span",{children:"Mathematical expressions"})]})]})]}):e.jsxs("div",{className:"welcome-setup",children:[e.jsx("p",{className:"welcome-description",children:"To get started, please enter your OpenAI API key"}),e.jsxs("button",{onClick:a,className:"setup-button",children:[e.jsx(Je,{className:"setup-icon"}),"Enter API Key"]})]})]})}),ns=n.memo(({content:s})=>e.jsx(ve,{remarkPlugins:[ke,Ne],rehypePlugins:[ye],skipHtml:!0,components:{code({inline:a,className:r,children:t,...o}){return a?e.jsx("code",{className:"inline-code",...o,children:t}):e.jsx("pre",{className:"code-block",children:e.jsx("code",{className:r,...o,children:String(t).replace(/\n$/,"")})})},ol:({children:a})=>e.jsx("ol",{className:"markdown-ordered-list",children:a}),ul:({children:a})=>e.jsx("ul",{className:"markdown-unordered-list",children:a}),li:({children:a})=>e.jsx("li",{className:"markdown-list-item",children:a}),p:({children:a})=>e.jsx("p",{className:"markdown-paragraph",children:a}),h1:({children:a})=>e.jsx("h1",{className:"markdown-h1",children:a}),h2:({children:a})=>e.jsx("h2",{className:"markdown-h2",children:a}),h3:({children:a})=>e.jsx("h3",{className:"markdown-h3",children:a})},children:s}),(s,a)=>s.content===a.content),ts=({message:s,index:a})=>e.jsx("div",{className:`message-container ${s.role}`,children:e.jsxs("div",{className:"message-wrapper",children:[e.jsx("div",{className:`message-bubble ${s.role}`,children:s.role==="assistant"?e.jsx(ns,{content:s.content}):s.content}),e.jsx("div",{className:`message-label ${s.role}`,children:s.role==="user"?"You":"Assistant"})]})},a),rs=()=>e.jsx("div",{className:"loading-container",children:e.jsxs("div",{className:"loading-bubble",children:[e.jsxs("div",{className:"loading-dots",children:[e.jsx("div",{className:"loading-dot"}),e.jsx("div",{className:"loading-dot"}),e.jsx("div",{className:"loading-dot"})]}),e.jsx("span",{className:"loading-text",children:"Thinking..."})]})}),W=[".pdf",".docx",".xlsx",".xls",".pptx",".ppt",".csv",".sql",".py",".js",".ts",".md",".txt"],ee={".pdf":"PDF Documents",".docx":"Word Documents",".xlsx":"Excel Spreadsheets",".xls":"Legacy Excel Spreadsheets",".pptx":"PowerPoint Presentations",".ppt":"Legacy PowerPoint Presentations",".csv":"Comma-Separated Values",".sql":"SQL Database Scripts",".py":"Python Source Code",".js":"JavaScript Source Code",".ts":"TypeScript Source Code",".md":"Markdown Documentation",".txt":"Plain Text Files"},os=10*1024*1024,se="10MB",ls=({apiKey:s,sessionId:a,onUploadSuccess:r,onUploadError:t,disabled:o=!1})=>{const[d,i]=n.useState(!1),[m,g]=n.useState(!1),f=n.useRef(null),x=n.useCallback(c=>{const l=c.toLowerCase().substring(c.lastIndexOf("."));return W.includes(l)},[]);n.useCallback(c=>{const l=c.toLowerCase().substring(c.lastIndexOf("."));return ee[l]||"Unknown file type"},[]);const y=n.useCallback(c=>c<=os,[]),w=n.useCallback(async c=>{if(!x(c.name)){const l=W.join(", ");t(`Unsupported file type. Supported formats: ${l}`);return}if(!y(c.size)){t(`File size exceeds ${se} limit. Please choose a smaller file.`);return}i(!0);try{h.debug("DocumentUpload: Starting document upload process",{fileName:c.name,fileSize:c.size,fileType:c.type});const l=await Te(c,s,a);h.info("DocumentUpload: Document successfully uploaded to knowledge base",{fileName:l.filename,sessionId:l.session_id,documentCount:l.document_count}),r(l)}catch(l){h.error("DocumentUpload: Failed to upload document",{fileName:c.name,error:l});const u=l instanceof Error?l.message:"Failed to upload document. Please try again.";t(u)}finally{i(!1)}},[s,a,r,t,x,y]),k=n.useCallback(c=>{c.preventDefault(),g(!1);const l=c.dataTransfer.files;if(l.length>0){const u=l[0];w(u)}},[w]),j=n.useCallback(c=>{c.preventDefault(),g(!0)},[]),v=n.useCallback(c=>{c.preventDefault(),g(!1)},[]),D=n.useCallback(c=>{const l=c.target.files;if(l&&l.length>0){const u=l[0];w(u)}},[w]),p=n.useCallback(()=>{var c;!o&&!d&&((c=f.current)==null||c.click())},[o,d]);return e.jsxs("div",{className:"document-upload-container",children:[e.jsxs("div",{className:`document-upload-area ${m?"drag-over":""} ${d?"uploading":""} ${o?"disabled":""}`,onDrop:k,onDragOver:j,onDragLeave:v,onClick:p,role:"button",tabIndex:0,"aria-label":"Upload document to knowledge base",children:[e.jsx("input",{ref:f,type:"file",accept:W.join(","),onChange:D,style:{display:"none"},disabled:o||d,"aria-label":"Select document file"}),d?e.jsxs("div",{className:"document-upload-loading-state",children:[e.jsx("div",{className:"document-upload-spinner"}),e.jsx("p",{className:"upload-loading-message",children:"Processing document and adding to knowledge base..."})]}):e.jsxs("div",{className:"document-upload-content",children:[e.jsx(We,{className:"document-upload-icon"}),e.jsxs("div",{className:"document-upload-text-container",children:[e.jsx("h3",{className:"document-upload-title",children:"Add Documents to Knowledge Base"}),e.jsxs("p",{className:"document-upload-description",children:["Drop files here or ",e.jsx("span",{className:"document-upload-link",children:"browse your device"})]})]}),e.jsxs("p",{className:"document-upload-hint",children:["Supports: Documents, Spreadsheets, Presentations, Code files, and more (Max: ",se,")"]})]})]}),e.jsx("div",{className:"supported-document-types",children:e.jsxs("details",{children:[e.jsx("summary",{children:"View all supported file formats"}),e.jsx("div",{className:"document-types-grid",children:Object.entries(ee).map(([c,l])=>e.jsxs("div",{className:"document-type-item",children:[e.jsx("code",{className:"file-extension",children:c}),e.jsx("span",{className:"file-description",children:l})]},c))})]})})]})},cs=({apiKey:s,onRefresh:a,onDeleteDocument:r})=>{const{globalKB:t,isLoading:o,isDeleting:d,error:i,hasError:m,hasDocuments:g,isInitializing:f,isAutoRefreshing:x,refresh:y}=te(),w=n.useCallback(j=>{r&&r(j)},[r]),k=async()=>{await y(),a==null||a()};return o&&!t?e.jsx("div",{className:"document-panel loading",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(Q,{className:"empty-icon spinning"}),e.jsx("p",{className:"empty-text",children:"Loading knowledge base..."}),e.jsx("p",{className:"empty-hint",children:"Please wait while we initialize the system"})]})}):m?e.jsx("div",{className:"document-panel error",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(M,{className:"empty-icon error"}),e.jsx("p",{className:"empty-text",children:"Knowledge base error"}),e.jsx("p",{className:"empty-hint",children:i||"Failed to load knowledge base"})]})}):f?e.jsx("div",{className:"document-panel initializing",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(Q,{className:"empty-icon spinning"}),e.jsx("p",{className:"empty-text",children:"Initializing knowledge base..."}),e.jsx("p",{className:"empty-hint",children:"Setting up knowledge base documents and embeddings"})]})}):g?e.jsxs("div",{className:"document-panel",children:[e.jsxs("div",{className:"document-panel-header",children:[e.jsxs("div",{className:"kb-info",children:[e.jsx(oe,{className:"rag-icon"}),e.jsxs("div",{children:[e.jsx("h3",{className:"kb-title",children:"Global Knowledge Base"}),e.jsxs("p",{className:"kb-subtitle",children:[t==null?void 0:t.document_count," document",(t==null?void 0:t.document_count)!==1?"s":""," â€¢ ",t==null?void 0:t.chunk_count," chunks",o&&e.jsx("span",{className:"updating-indicator",children:" â€¢ Updating..."}),x&&!o&&e.jsx("span",{className:"auto-refresh-indicator",children:" â€¢ Auto-refreshing..."})]})]})]}),e.jsx("button",{onClick:k,className:"refresh-button",title:"Refresh knowledge base",disabled:o,children:e.jsx(re,{className:`refresh-icon ${o||x?"spinning":""}`})})]}),e.jsxs("div",{className:"kb-status",children:[e.jsxs("div",{className:"kb-indicator ready",children:[e.jsx("div",{className:"kb-dot"}),e.jsx("span",{children:"Knowledge base ready"})]}),e.jsx("p",{className:"kb-description",children:t==null?void 0:t.description})]}),t&&t.documents.length>0&&e.jsxs("div",{className:"documents-section",children:[e.jsx("h4",{className:"section-title",children:"Original Documents"}),e.jsx("div",{className:"documents-list",children:t.documents.map((j,v)=>e.jsxs("div",{className:"document-item original",children:[e.jsx(Z,{className:"document-icon"}),e.jsxs("div",{className:"document-info",children:[e.jsx("span",{className:"document-name",children:j}),e.jsx("span",{className:"document-status",children:"âœ“ Pre-loaded"})]}),e.jsx("div",{className:"document-type-badge",children:"Original"})]},`original-${v}`))})]}),t&&t.user_uploaded_documents.length>0&&e.jsxs("div",{className:"documents-section",children:[e.jsx("h4",{className:"section-title",children:"Your Uploaded Documents"}),e.jsx("div",{className:"documents-list",children:t.user_uploaded_documents.map((j,v)=>e.jsxs("div",{className:"document-item user-uploaded",children:[e.jsx(Z,{className:"document-icon"}),e.jsxs("div",{className:"document-info",children:[e.jsx("span",{className:"document-name",children:j}),e.jsx("span",{className:"document-status",children:"âœ“ Indexed"})]}),e.jsx("button",{onClick:()=>w(j),className:"delete-button",title:`Delete ${j}`,disabled:d===j,children:d===j?e.jsx("div",{className:"loading-spinner"}):e.jsx(es,{className:"delete-icon"})})]},`user-${v}`))})]}),t&&t.user_uploaded_documents.length===0&&e.jsxs("div",{className:"upload-prompt",children:[e.jsx("p",{className:"prompt-text",children:"Upload documents to add to the knowledge base"}),e.jsx("p",{className:"prompt-hint",children:"Your uploaded documents will be available to everyone"})]})]}):e.jsx("div",{className:"document-panel empty",children:e.jsxs("div",{className:"empty-state",children:[e.jsx(Z,{className:"empty-icon"}),e.jsx("p",{className:"empty-text",children:"No documents available"}),e.jsx("p",{className:"empty-hint",children:"Upload a document to get started"})]})})},is=({isOpen:s,title:a,message:r,confirmText:t="Confirm",cancelText:o="Cancel",onConfirm:d,onCancel:i,type:m="danger",isLoading:g=!1})=>{if(n.useEffect(()=>{const w=k=>{k.key==="Escape"&&s&&!g&&i()};return s&&(document.addEventListener("keydown",w),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",w),document.body.style.overflow="unset"}},[s,i,g]),!s)return null;const f=w=>{w.target===w.currentTarget&&!g&&i()},x=()=>{switch(m){case"danger":return"icon-danger";case"warning":return"icon-warning";case"info":return"icon-info";default:return"icon-danger"}},y=()=>{switch(m){case"danger":return"confirm-button-danger";case"warning":return"confirm-button-warning";case"info":return"confirm-button-info";default:return"confirm-button-danger"}};return e.jsx("div",{className:"modal-backdrop",onClick:f,children:e.jsxs("div",{className:"modal-container",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-icon-container",children:e.jsx(M,{className:`modal-icon ${x()}`})}),e.jsxs("div",{className:"modal-title-section",children:[e.jsx("h3",{id:"modal-title",className:"modal-title",children:a}),e.jsx("p",{className:"modal-message",children:r})]}),e.jsx("button",{onClick:i,className:"modal-close-button",disabled:g,"aria-label":"Close modal",children:e.jsx(le,{className:"close-icon"})})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:i,className:"cancel-button",disabled:g,children:o}),e.jsx("button",{onClick:d,className:`confirm-button ${y()}`,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"loading-spinner-small"}),"Deleting..."]}):t})]})]})})};class ds extends n.Component{constructor(a){super(a),this.handleReload=()=>{window.location.reload()},this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){var t,o;console.error("ðŸš¨ Error Boundary caught an error:",a,r),this.setState({error:a,errorInfo:r}),(o=(t=this.props).onError)==null||o.call(t,a,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon-container",children:e.jsx(M,{className:"error-icon"})}),e.jsxs("div",{className:"error-content",children:[e.jsx("h1",{className:"error-title",children:"Oops! Something went wrong"}),e.jsx("p",{className:"error-description",children:"We encountered an unexpected error. This usually happens when something goes wrong with the application state or network connection."}),!1,e.jsxs("div",{className:"error-actions",children:[e.jsxs("button",{onClick:this.handleReset,className:"error-button primary","aria-label":"Try again",children:[e.jsx(re,{className:"button-icon"}),"Try Again"]}),e.jsx("button",{onClick:this.handleReload,className:"error-button secondary","aria-label":"Reload page",children:"Reload Page"})]}),e.jsxs("div",{className:"error-help",children:[e.jsx("p",{className:"help-text",children:"If this problem persists:"}),e.jsxs("ul",{className:"help-list",children:[e.jsx("li",{children:"Check your internet connection"}),e.jsx("li",{children:"Clear your browser cache and cookies"}),e.jsx("li",{children:"Try refreshing the page"}),e.jsx("li",{children:"Contact support if the issue continues"})]})]})]})]})}):this.props.children}}const us=n.memo(({messages:s,messagesEndRef:a})=>e.jsxs("div",{className:"messages-container",children:[s.map((r,t)=>e.jsx(ts,{message:r,index:t},`${r.role}-${t}-${r.content.slice(0,20)}`)),e.jsx("div",{ref:a})]})),ms=n.memo(({input:s,setInput:a,onSubmit:r,isLoading:t,disabled:o})=>{const d=n.useCallback(m=>{a(m.target.value)},[a]),i=n.useCallback(m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),!o&&s.trim()&&r(m))},[r,o,s]);return e.jsx("form",{onSubmit:r,className:"chat-input-form",children:e.jsxs("div",{className:"input-container",children:[e.jsx("textarea",{value:s,onChange:d,onKeyDown:i,placeholder:"Type your message... (Press Enter to send, Shift+Enter for new line)",className:"message-input",disabled:o,rows:1,style:{minHeight:"44px",maxHeight:"120px",resize:"none",overflow:"auto"}}),e.jsx("button",{type:"submit",disabled:o||!s.trim(),className:"send-button","aria-label":"Send message",children:t?e.jsx("div",{className:"loading-spinner"}):e.jsx(_e,{className:"send-icon"})})]})})}),hs=({messages:s,input:a,setInput:r,isLoading:t,apiKey:o,ragMode:d,onSubmit:i,messagesEndRef:m,globalKBReady:g,hasActiveSession:f})=>{const x=n.useMemo(()=>!o||t,[o,t]),y=n.useMemo(()=>o?d&&!g&&!f?"RAG mode enabled but no knowledge base available":d&&(g||f)?"RAG mode: Enhanced with knowledge base":"Regular chat mode":"Enter API key to start chatting",[o,d,g,f]),w=n.useCallback(async k=>{try{await i(k)}catch(j){h.error("Chat submission error:",j)}},[i]);return e.jsxs("div",{className:"chat-container",children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"chat-status",children:[e.jsx("div",{className:`status-indicator ${d?"rag-active":"regular"}`}),e.jsx("span",{className:"status-text",children:y})]}),d&&(g||f)&&e.jsx("div",{className:"rag-badge",children:e.jsx("span",{className:"rag-label",children:"RAG Enhanced"})})]}),e.jsxs("div",{className:"chat-messages",children:[s.length===0?e.jsx("div",{className:"empty-chat",children:e.jsxs("div",{className:"empty-chat-content",children:[e.jsx("h3",{children:"Start a conversation"}),e.jsx("p",{children:o?"Ask me anything! I can help with general questions or analyze your documents if you upload them.":"Please enter your OpenAI API key to begin chatting."})]})}):e.jsx(us,{messages:s,messagesEndRef:m}),t&&e.jsxs("div",{className:"loading-container",children:[e.jsx(rs,{}),e.jsx("span",{className:"loading-text",children:d?"Analyzing documents and generating response...":"Generating response..."})]})]}),e.jsxs("div",{className:"chat-input-area",children:[e.jsx(ms,{input:a,setInput:r,onSubmit:w,isLoading:t,disabled:x}),!o&&e.jsx("div",{className:"input-help",children:e.jsx("span",{children:"ðŸ”‘ API key required to send messages"})})]})]})},Y=({type:s,message:a,isVisible:r,onClose:t,autoClose:o=!0,duration:d=5e3})=>{const i=n.useCallback(()=>{t()},[t]),m=n.useMemo(()=>{switch(s){case"success":return{icon:ze,bgColor:"bg-green-50",borderColor:"border-green-200",iconColor:"text-green-400",textColor:"text-green-800",closeColor:"text-green-500"};case"error":return{icon:M,bgColor:"bg-red-50",borderColor:"border-red-200",iconColor:"text-red-400",textColor:"text-red-800",closeColor:"text-red-500"};case"warning":return{icon:M,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",iconColor:"text-yellow-400",textColor:"text-yellow-800",closeColor:"text-yellow-500"};default:return{icon:M,bgColor:"bg-blue-50",borderColor:"border-blue-200",iconColor:"text-blue-400",textColor:"text-blue-800",closeColor:"text-blue-500"}}},[s]);if(Se.useEffect(()=>{if(r&&o){const f=setTimeout(()=>{t()},d);return()=>clearTimeout(f)}},[r,o,d,t]),!r)return null;const g=m.icon;return e.jsxs("div",{className:`notification notification-${s} ${r?"visible":""}`,children:[e.jsxs("div",{className:"notification-content",children:[e.jsx("div",{className:"notification-icon",children:e.jsx(g,{className:"icon"})}),e.jsx("div",{className:"notification-message",children:a}),e.jsx("button",{onClick:i,className:"notification-close","aria-label":"Close notification",children:e.jsx(le,{className:"close-icon"})})]}),o&&e.jsx("div",{className:"notification-progress",style:{animationDuration:`${d}ms`}})]})},ps=({successNotification:s,errorNotification:a,warningNotification:r})=>n.useMemo(()=>(s==null?void 0:s.isVisible)||(a==null?void 0:a.isVisible)||(r==null?void 0:r.isVisible),[s==null?void 0:s.isVisible,a==null?void 0:a.isVisible,r==null?void 0:r.isVisible])?e.jsx("div",{className:"notification-manager",children:e.jsxs("div",{className:"notifications-container",children:[(s==null?void 0:s.isVisible)&&e.jsx(Y,{type:"success",message:s.message,isVisible:s.isVisible,onClose:s.onClose}),(a==null?void 0:a.isVisible)&&e.jsx(Y,{type:"error",message:a.message,isVisible:a.isVisible,onClose:a.onClose,autoClose:!1}),(r==null?void 0:r.isVisible)&&e.jsx(Y,{type:"warning",message:r.message,isVisible:r.isVisible,onClose:r.onClose})]})}):null;function gs(){const{messages:s,input:a,setInput:r,isLoading:t,apiKey:o,setApiKey:d,showApiKey:i,setShowApiKey:m,messagesEndRef:g,addMessage:f,setIsLoading:x}=$e(),{sessionInfo:y,isUploading:w,uploadError:k,sendRAGChat:j,hasActiveSession:v,clearUploadError:D,refreshSessionInfo:p,validateSession:c}=Fe(),{isReady:l,refresh:u,deleteUserDocument:b,isDeleting:S}=te(),[N,E]=n.useState(!1),[I,$]=n.useState(!1),[_,O]=n.useState(!1),[B,ce]=n.useState(""),[A,F]=n.useState({isOpen:!1,filename:null}),ie=n.useMemo(()=>s.length>0,[s.length]);n.useMemo(()=>o&&!t,[o,t]),n.useMemo(()=>N?l||v(!1)?"ready":"unavailable":"disabled",[N,l,v]);const de=n.useMemo(()=>l||v(l),[l,v]);n.useEffect(()=>{y&&c()},[y,c]);const ue=n.useCallback(async C=>{var K;if(C.preventDefault(),!a.trim()||!o||t)return;const T=a.trim();r(""),f({role:"user",content:T}),x(!0);try{if(N&&(l||v(l))){if(v(l)&&!await c()&&!l){f({role:"assistant",content:"Your session has expired. Please upload a document again to continue using RAG mode."}),E(!1),x(!1);return}const R=await j(T,o);if(R){const P=new TextDecoder;let U="";const L={role:"assistant",content:""};for(f(L);;){const{done:G,value:H}=await R.read();if(G)break;const V=P.decode(H);U+=V,L.content=U}}}else{const R=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({developer_message:"You are a helpful assistant.",user_message:T,model:"gpt-4o-mini",api_key:o})});if(!R.ok)throw new Error(`HTTP error! status: ${R.status}`);const P=(K=R.body)==null?void 0:K.getReader();if(!P)throw new Error("No reader available");const U=new TextDecoder;let L="";const G={role:"assistant",content:""};for(f(G);;){const{done:H,value:V}=await P.read();if(H)break;const we=U.decode(V);L+=we,G.content=L}}}catch(R){h.error("Chat error:",R),f({role:"assistant",content:`Sorry, I encountered an error: ${R instanceof Error?R.message:"Unknown error"}`})}finally{x(!1)}},[a,o,t,N,l,v,c,j,f,r,x]),me=n.useCallback(async C=>{h.debug("Upload successful in App:",C),E(!0),D(),$(!1),ce(`Successfully uploaded "${C.filename}" - added to global knowledge base`),O(!0),setTimeout(()=>O(!1),5e3),C.session_id&&await p(C.session_id),await u()},[D,p,u]),he=n.useCallback(C=>{$(!0),O(!1)},[]),pe=n.useCallback(()=>{E(C=>!C)},[]),ge=n.useCallback(()=>{l&&E(!0)},[l]),fe=n.useCallback(C=>{F({isOpen:!0,filename:C})},[]),xe=n.useCallback(async()=>{const{filename:C}=A;if(C)try{h.debug(`Deleting document: ${C}`),F({isOpen:!1,filename:null}),await b(C),h.debug("Document deleted successfully, refreshing data..."),await Promise.all([y!=null&&y.session_id?p(y.session_id):Promise.resolve(),u()])}catch(T){h.error("Error in delete confirmation:",T)}},[A,b,p,u]),je=n.useCallback(()=>{F({isOpen:!1,filename:null})},[]),q=n.useCallback(()=>{O(!1)},[]),J=n.useCallback(()=>{$(!1)},[]),be=n.useMemo(()=>({successNotification:_?{message:B,isVisible:_,onClose:q}:void 0,errorNotification:I?{message:k||"Upload failed",isVisible:I,onClose:J}:void 0}),[_,B,I,k,q,J]);return e.jsx(ds,{children:e.jsxs("div",{className:"app",children:[e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-container",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"header-title",children:"AI Chat Assistant"}),de&&e.jsx("div",{className:"rag-toggle",children:e.jsxs("button",{onClick:pe,className:`rag-toggle-button ${N?"active":""}`,title:N?"Disable RAG mode":"Enable RAG mode",children:[e.jsx(Me,{className:"rag-toggle-icon"}),"RAG Mode"]})})]}),e.jsx("div",{className:"header-controls",children:e.jsxs("button",{onClick:()=>m(!i),className:"api-key-button",title:"Configure API Key",children:[e.jsx(Re,{className:"api-key-icon"}),e.jsx("span",{className:"hidden-mobile",children:"API Key"})]})})]})}),i&&e.jsx("div",{className:"api-key-section",children:e.jsxs("div",{className:"api-key-form",children:[e.jsx("label",{className:"api-key-label",children:"OpenAI API Key:"}),e.jsx("input",{type:"password",value:o||"",onChange:C=>d(C.target.value),placeholder:"sk-...",className:"api-key-input"}),e.jsx("button",{onClick:()=>m(!1),className:"done-button",children:"Done"})]})}),e.jsx("main",{className:"main-container",children:e.jsxs("div",{className:"layout-container",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsx("div",{className:"upload-section",children:e.jsx(ls,{onUploadSuccess:me,onUploadError:he,disabled:w,apiKey:o})}),e.jsx("div",{className:"document-section",children:e.jsx(cs,{apiKey:o,onRefresh:u,onDeleteDocument:fe})})]}),e.jsx("div",{className:"chat-container",children:ie||o?e.jsx(hs,{messages:s,input:a,setInput:r,isLoading:t,apiKey:o,ragMode:N,onSubmit:ue,messagesEndRef:g,globalKBReady:l,hasActiveSession:v(l)}):e.jsx(as,{apiKey:o,onEnterApiKey:()=>m(!0),onTryGlobalKB:ge})})]})}),e.jsx(ps,{...be}),A.isOpen&&e.jsx(is,{isOpen:A.isOpen,title:"Delete Document",message:`Are you sure you want to delete "${A.filename}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",onConfirm:xe,onCancel:je,isLoading:S===A.filename})]})})}ae(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(gs,{})}));
